import{r as ref,l as computed,o as onMounted,a as resolveComponent,b as openBlock,c as createElementBlock,f as createBaseVNode,e as createVNode,w as withCtx,u as unref,t as toDisplayString,h as createBlock,j as router,m as isRef,g as createTextVNode,i as createCommentVNode,E as ElMessage}from"./index-CTbHhZdW.js";import{d as deal,a as dealMethodApi}from"./common-6M1q-0TG.js";import{_ as _export_sfc}from"./_plugin-vue_export-helper-DlAUqK2U.js";const searchServerTopList=ref(""),searchServerList=ref(""),searchClassList=ref(""),searchMethodList=ref(""),list=ref({searchServerTopList:[],serverTopList:[],serverList:[],searchServerList:[],searchClassList:[],searchMethodList:[]}),po=ref({serverDetail:{serverName:null,name:null,desc:null},serverPo:{name:null,ip:null,port:null,weight:null,area:null,classList:[]},classList:{name:null,path:null,version:null,methodList:[]},methodDetail:{name:null,parameterList:[]},parameterList:{name:null,parameterList:[],parameterJson:null},dealMethodPo:{id:null,token:null,serverName:null,className:null,version:null,methodName:null,data:null,result:null,jsonData:{}}}),dialog=ref({editServer:!1});function getTopServerListApi(){return deal("CrpcServer/CenterService/getTopServerList/V1",null)}function getServerListApi(e){return deal("CrpcServer/CenterService/getServerList/V1",e)}function getServerBalanceApi(e){return deal("CrpcServer/CenterService/getServerBalance/V1",e)}function setServerDetailApi(e){return deal("CrpcServer/CenterService/setServerDetail/V1",e)}function getServerUsedApi(e){return deal("CrpcServer/InterfaceService/getServerUsed/V1",e)}function getRequestLogsApi(e){return deal("CrpcServer/CenterService/getRequestLogs/V1",e)}const _hoisted_1={class:"container"},_hoisted_2={class:"server-list"},_hoisted_3={class:"table-cell"},_hoisted_4={class:"table-cell"},_hoisted_5={class:"table-cell"},_hoisted_6={class:"table-cell"},_hoisted_7={class:"table-cell"},_hoisted_8={slot:"footer",class:"dialog-footer"},_hoisted_9={class:"table-cell"},_hoisted_10={class:"table-cell"},_hoisted_11={class:"service-list"},_hoisted_12={class:"table-cell"},_hoisted_13={key:0,class:"table-cell"},_hoisted_14={style:{width:"100%","margin-top":"20px"}},_hoisted_15={style:{"font-size":"large","font-weight":"bolder","margin-bottom":"1%"}},_hoisted_16={label:"结果数据"},_sfc_main={__name:"IndexView",setup(__props){function getServerUsed(e){po.value.dealMethodPo.serverName=e.serverName,getServerUsedApi(e.serverName).then(a=>{list.value.serverList=a.data.data,list.value.searchServerList=list.value.serverList})}function getServerList(e){po.value.dealMethodPo.serverName=e.serverName,getServerListApi(e.serverName).then(a=>{e.status=a.data.data.length!==0,list.value.serverList=a.data.data,list.value.searchServerList=list.value.serverList})}function getServerBalance(e){po.value.dealMethodPo.serverName=e.serverName,getServerBalanceApi(e.serverName).then(a=>{e.status=a.data.data.length!==0,list.value.serverList=a.data.data,list.value.searchServerList=list.value.serverList})}function editDialog(e){dialog.value.editServer=!0,po.value.serverDetail=e}function edit(){setServerDetailApi(po.value.serverDetail).then(e=>{ElMessage.success("修改成功！")})}function showServerDetail(e){po.value.dealMethodPo.name=e.name,po.value.serverPo=e,list.value.searchClassList=e.classList}function showMethod(method,row){if(po.value.dealMethodPo.className=row.name,po.value.dealMethodPo.methodName=method.name,po.value.dealMethodPo.version=row.version,method.parameterList.length!==0){let args=method.parameterList[0].parameterList;args!==null?(po.value.dealMethodPo.data=method.parameterList[0].parameterJson,po.value.dealMethodPo.jsonData=eval("("+method.parameterList[0].parameterJson+")")):po.value.dealMethodPo.data=""}else po.value.dealMethodPo.data=""}function dealMethod(){po.value.dealMethodPo.token=localStorage.getItem("token"),dealMethodApi(po.value.dealMethodPo).then(e=>{po.value.dealMethodPo.result=e.data,po.value.dealMethodPo.result.dataJson=JSON.stringify(e.data.data,null,2).replace(/\\n/g,`
`)})}function showMethodDetail(e){po.value.dealMethodPo.className=e.name,po.value.dealMethodPo.version=e.version,po.value.classList=e,list.value.searchMethodList=po.value.classList.methodList}function getTopServerList(){getTopServerListApi().then(e=>{list.value.serverTopList=e.data.data,list.value.searchServerTopList=list.value.serverTopList}).catch(e=>{router.push("/auth")})}const searchServerTopListFilter=computed(()=>list.value.serverTopList.filter(e=>!searchServerTopList.value||e.serverName&&e.serverName.toLowerCase().includes(searchServerTopList.value.toLowerCase())||e.name&&e.name.toLowerCase().includes(searchServerTopList.value.toLowerCase())||e.desc&&e.desc.toLowerCase().includes(searchServerTopList.value.toLowerCase()))),searchServerListFilter=computed(()=>list.value.searchServerList.filter(e=>!searchServerList.value||e.name&&e.name.toLowerCase().includes(searchServerList.value.toLowerCase())||e.ip&&e.ip.includes(searchServerList.value)||e.port&&e.port.toString().includes(searchServerList.value)||e.weight&&e.weight.toString().includes(searchServerList.value)||e.area&&e.area.toLowerCase().includes(searchServerList.value.toLowerCase()))),searchClassListFilter=computed(()=>list.value.searchClassList.filter(e=>!searchClassList.value||e.name&&e.name.toLowerCase().includes(searchClassList.value.toLowerCase())||e.path&&e.path.toLowerCase().includes(searchClassList.value.toLowerCase())||e.version&&e.version.toLowerCase().includes(searchClassList.value.toLowerCase()))),searchMethodListFilter=computed(()=>list.value.searchMethodList.filter(e=>!searchMethodList.value||e.name&&e.name.toLowerCase().includes(searchMethodList.value.toLowerCase())||e.parameterList.length>0&&e.parameterList[0].name.toLowerCase().includes(searchMethodList.value.toLowerCase())));return onMounted(()=>{getTopServerList()}),(e,a)=>{const l=resolveComponent("el-input"),r=resolveComponent("el-link"),v=resolveComponent("el-popover"),o=resolveComponent("el-table-column"),p=resolveComponent("el-text"),i=resolveComponent("el-table"),d=resolveComponent("el-form-item"),h=resolveComponent("el-form"),c=resolveComponent("el-button"),m=resolveComponent("el-dialog"),u=resolveComponent("el-tag"),n=resolveComponent("el-descriptions-item"),_=resolveComponent("el-descriptions");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createVNode(i,{data:searchServerTopListFilter.value,style:{width:"100%"},stripe:"",height:"250"},{default:withCtx(()=>[createVNode(o,{sortable:"",prop:"serverName",label:"服务名",width:"200"},{header:withCtx(()=>[createVNode(l,{modelValue:unref(searchServerTopList),"onUpdate:modelValue":a[0]||(a[0]=t=>isRef(searchServerTopList)?searchServerTopList.value=t:null),style:{width:"80%"},size:"small",placeholder:"Type to search"},null,8,["modelValue"])]),default:withCtx(t=>[createVNode(v,{trigger:"hover",placement:"top",width:"auto"},{default:withCtx(()=>[createBaseVNode("div",null,"名称: "+toDisplayString(t.row.name),1),createBaseVNode("div",null,"描述: "+toDisplayString(t.row.desc),1)]),reference:withCtx(()=>[createVNode(r,{type:"primary",plain:""},{default:withCtx(()=>[createTextVNode(toDisplayString(t.row.serverName),1)]),_:2},1024)]),_:2},1024)]),_:1}),createVNode(o,{prop:"status",label:"列表",width:"80"},{default:withCtx(t=>[createBaseVNode("div",_hoisted_3,[t.row.status?(openBlock(),createBlock(r,{key:0,type:"primary",plain:"",onClick:s=>getServerList(t.row)},{default:withCtx(()=>[createTextVNode(" 查看 ")]),_:2},1032,["onClick"])):createCommentVNode("",!0)])]),_:1}),createVNode(o,{prop:"status",label:"调用",width:"80"},{default:withCtx(t=>[createBaseVNode("div",_hoisted_4,[t.row.status?(openBlock(),createBlock(r,{key:0,type:"primary",plain:"",onClick:s=>getServerUsed(t.row)},{default:withCtx(()=>[createTextVNode(" 查看 ")]),_:2},1032,["onClick"])):createCommentVNode("",!0)])]),_:1}),createVNode(o,{sortable:"",prop:"status",label:"状态",width:"80"},{default:withCtx(t=>[createBaseVNode("div",_hoisted_5,[t.row.status?(openBlock(),createBlock(p,{key:0,type:"success"},{default:withCtx(()=>[createTextVNode("正常")]),_:1})):(openBlock(),createBlock(p,{key:1,type:"danger"},{default:withCtx(()=>[createTextVNode("停机")]),_:1}))])]),_:1}),createVNode(o,{prop:"status",label:"负载均衡",width:"120"},{default:withCtx(t=>[createBaseVNode("div",_hoisted_6,[createVNode(r,{type:"primary",plain:"",onClick:s=>getServerBalance(t.row)},{default:withCtx(()=>[createTextVNode("随机")]),_:2},1032,["onClick"])])]),_:1}),createVNode(o,{prop:"edit",label:"编辑",width:"80"},{default:withCtx(t=>[createBaseVNode("div",_hoisted_7,[createVNode(r,{type:"primary",plain:"",onClick:s=>editDialog(t.row)},{default:withCtx(()=>[createTextVNode("编辑")]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"]),createVNode(m,{modelValue:unref(dialog).editServer,"onUpdate:modelValue":a[4]||(a[4]=t=>unref(dialog).editServer=t),title:unref(po).serverDetail.serverName},{default:withCtx(()=>[createVNode(h,{model:unref(po).serverDetail},{default:withCtx(()=>[createVNode(d,{label:"昵称"},{default:withCtx(()=>[createVNode(l,{modelValue:unref(po).serverDetail.name,"onUpdate:modelValue":a[1]||(a[1]=t=>unref(po).serverDetail.name=t)},null,8,["modelValue"])]),_:1}),createVNode(d,{label:"描述"},{default:withCtx(()=>[createVNode(l,{modelValue:unref(po).serverDetail.desc,"onUpdate:modelValue":a[2]||(a[2]=t=>unref(po).serverDetail.desc=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),createBaseVNode("div",_hoisted_8,[createVNode(c,{onClick:a[3]||(a[3]=t=>unref(dialog).editServer=!1)},{default:withCtx(()=>[createTextVNode("取消")]),_:1}),createVNode(c,{type:"primary",onClick:edit},{default:withCtx(()=>[createTextVNode("确认")]),_:1})])]),_:1},8,["modelValue","title"]),createVNode(i,{data:searchServerListFilter.value,style:{width:"100%","margin-top":"2%"},stripe:"",height:"250"},{default:withCtx(()=>[createVNode(o,{sortable:"",prop:"name",label:"服务名","min-width":"150"},{header:withCtx(()=>[createVNode(l,{modelValue:unref(searchServerList),"onUpdate:modelValue":a[5]||(a[5]=t=>isRef(searchServerList)?searchServerList.value=t:null),style:{width:"80%"},size:"small",placeholder:"Type to search"},null,8,["modelValue"])]),default:withCtx(t=>[createBaseVNode("div",_hoisted_9,[createVNode(r,{type:"primary",plain:"",onClick:s=>showServerDetail(t.row)},{default:withCtx(()=>[createTextVNode(toDisplayString(t.row.name),1)]),_:2},1032,["onClick"])])]),_:1}),createVNode(o,{sortable:"",prop:"ip",label:"IP","min-width":"90"}),createVNode(o,{sortable:"",prop:"port",label:"端口号",width:"90"}),createVNode(o,{sortable:"",prop:"weight",label:"权重",width:"90"}),createVNode(o,{sortable:"",prop:"area",label:"区域",width:"90"})]),_:1},8,["data"]),createVNode(i,{data:searchClassListFilter.value,style:{width:"100%","margin-top":"2%"},stripe:"",height:"250"},{default:withCtx(()=>[createVNode(o,{sortable:"",prop:"name",label:"类名","min-width":"150"},{header:withCtx(()=>[createVNode(l,{modelValue:unref(searchClassList),"onUpdate:modelValue":a[6]||(a[6]=t=>isRef(searchClassList)?searchClassList.value=t:null),style:{width:"80%"},size:"small",placeholder:"Type to search"},null,8,["modelValue"])]),default:withCtx(t=>[createBaseVNode("div",_hoisted_10,[createVNode(r,{type:"primary",plain:"",onClick:s=>showMethodDetail(t.row)},{default:withCtx(()=>[createTextVNode(toDisplayString(t.row.name),1)]),_:2},1032,["onClick"])])]),_:1}),createVNode(o,{sortable:"",prop:"path",label:"类路径","min-width":"160"}),createVNode(o,{sortable:"",prop:"version",label:"类标识","min-width":"60"})]),_:1},8,["data"])]),createBaseVNode("div",_hoisted_11,[createBaseVNode("div",null,[createVNode(i,{data:searchMethodListFilter.value,style:{width:"100%"},stripe:"",height:"250"},{default:withCtx(()=>[createVNode(o,{sortable:"",prop:"name",label:"方法",width:"150"},{header:withCtx(()=>[createVNode(l,{modelValue:unref(searchMethodList),"onUpdate:modelValue":a[7]||(a[7]=t=>isRef(searchMethodList)?searchMethodList.value=t:null),style:{width:"80%"},size:"small",placeholder:"Type to search"},null,8,["modelValue"])]),default:withCtx(t=>[createBaseVNode("div",_hoisted_12,[createVNode(r,{type:"primary",plain:"",onClick:s=>showMethod(t.row,unref(po).classList)},{default:withCtx(()=>[createTextVNode(toDisplayString(t.row.name),1)]),_:2},1032,["onClick"])])]),_:1}),createVNode(o,{sortable:"",prop:"deal",label:"属性",width:"120"},{default:withCtx(t=>[t.row.parameterList.length>0?(openBlock(),createElementBlock("div",_hoisted_13,toDisplayString(t.row.parameterList[0].name),1)):createCommentVNode("",!0)]),_:1})]),_:1},8,["data"])]),createBaseVNode("div",_hoisted_14,[createBaseVNode("div",_hoisted_15,toDisplayString(unref(po).dealMethodPo.serverName)+" - "+toDisplayString(unref(po).dealMethodPo.className)+" - "+toDisplayString(unref(po).dealMethodPo.methodName)+" - "+toDisplayString(unref(po).dealMethodPo.version),1),createBaseVNode("div",null,[createVNode(h,{model:unref(po).dealMethodPo,style:{"margin-top":"10px"}},{default:withCtx(()=>[createVNode(d,{label:""},{default:withCtx(()=>[createVNode(l,{type:"textarea",modelValue:unref(po).dealMethodPo.data,"onUpdate:modelValue":a[8]||(a[8]=t=>unref(po).dealMethodPo.data=t),placeholder:"data",clearable:"",rows:6,size:"small"},null,8,["modelValue"])]),_:1}),createVNode(d,null,{default:withCtx(()=>[createVNode(c,{type:"primary",onClick:dealMethod,size:"small"},{default:withCtx(()=>[createTextVNode("执行")]),_:1})]),_:1})]),_:1},8,["model"])]),createBaseVNode("div",null,[createBaseVNode("div",null,[createVNode(_,{title:"",size:"small"},{default:withCtx(()=>[unref(po).dealMethodPo.result!=null?(openBlock(),createBlock(n,{key:0,label:"结果状态码"},{default:withCtx(()=>[unref(po).dealMethodPo.result.code===200?(openBlock(),createBlock(u,{key:0,class:"ml-2",type:"success",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(po).dealMethodPo.result.code),1)]),_:1})):(openBlock(),createBlock(u,{key:1,class:"ml-2",type:"danger",size:"small"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(po).dealMethodPo.result.code),1)]),_:1}))]),_:1})):(openBlock(),createBlock(n,{key:1,label:"结果状态码"},{default:withCtx(()=>[createVNode(u,{class:"ml-2",type:"success",size:"small"},{default:withCtx(()=>[createTextVNode("0")]),_:1})]),_:1})),unref(po).dealMethodPo.result!=null?(openBlock(),createBlock(n,{key:2,label:"结果消息"},{default:withCtx(()=>[createTextVNode(toDisplayString(unref(po).dealMethodPo.result.message),1)]),_:1})):(openBlock(),createBlock(n,{key:3,label:"结果消息"},{default:withCtx(()=>[createTextVNode("0 ")]),_:1}))]),_:1})]),createBaseVNode("div",_hoisted_16,[unref(po).dealMethodPo.result!=null?(openBlock(),createBlock(l,{key:0,type:"textarea",modelValue:unref(po).dealMethodPo.result.dataJson,"onUpdate:modelValue":a[9]||(a[9]=t=>unref(po).dealMethodPo.result.dataJson=t),placeholder:"data",clearable:"",rows:6,size:"small"},null,8,["modelValue"])):(openBlock(),createBlock(l,{key:1,type:"textarea",placeholder:"data",clearable:"",rows:6,size:"small"}))])])])])])}}},server=_export_sfc(_sfc_main,[["__scopeId","data-v-01e822dc"]]),IndexView=Object.freeze(Object.defineProperty({__proto__:null,default:server},Symbol.toStringTag,{value:"Module"}));export{IndexView as I,getRequestLogsApi as g,server as s};
